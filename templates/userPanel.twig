{% extends "base.twig" %}

{% block title %}Obituario de mascotas{% endblock %}
{% block head %}
    {{ parent() }}
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h3 class="mb-4">Añadir mascota al obituario</h3>
        <! -- https://chatgpt.com/c/6849e89e-c1a8-8000-9ea3-94763d969a23 -->

        <div class="card p-4 border rounded shadow-sm bg-white">
            <form id="obituary-form" method="POST" enctype="multipart/form-data" action="/mascota/guardar">
                <div class="row g-3">

                    <!-- Nombre -->
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" name="name" id="name" class="form-control" placeholder="Nombre" required>
                            <label for="name">Nombre del animal *</label>
                        </div>
                    </div>

                    <!-- Tipo de animal -->
                    <div class="col-md-3">
                        <div class="form-floating">
                            <select name="type" id="type" class="form-select" required>
                                <option disabled selected>Selecciona tipo</option>
                                <option value="perro">Perro</option>
                                <option value="gato">Gato</option>
                                <option value="otro">Otro</option>
                            </select>
                            <label for="type">Tipo de mascota *</label>
                        </div>
                    </div>

                    <!-- Tipo personalizado (si es "Otro") -->
                    <div class="col-md-6 d-none" id="custom-type-container">
                        <div class="form-floating">
                            <input type="text" name="custom_type" id="custom-type" class="form-control" placeholder="Tipo de mascota">
                            <label for="custom-type">Especifica el tipo</label>
                        </div>
                    </div>

                    <!-- Raza -->
                    <div class="col-md-4" id="breed-container">
                        <div class="form-floating">
                            <select name="breed" id="breed" class="form-select" required>
                                <option disabled selected>Selecciona raza</option>
                            </select>
                            <label for="breed">Raza *</label>
                        </div>
                        <div class="form-check mt-2">
                            <input type="checkbox" class="form-check-input" id="mixedBreed">
                            <label class="form-check-label" for="mixedBreed">
                                ¿Es cruce? <span class="text-muted small">(Ej: cruce de pastor alemán)</span>
                            </label>
                        </div>
                        <div class="form-floating mt-2 d-none" id="custom-breed-container">
                            <input type="text" name="custom_breed" id="custom-breed" class="form-control" placeholder="Introduce la raza">
                            <label for="custom-breed">Introduce la raza</label>
                        </div>
                    </div>

                    <!-- Fecha nacimiento -->
                    <div class="col-md-2">
                        <div class="form-floating">
                            <input type="date" name="birth_date" id="birth_date" class="form-control" required>
                            <label for="birth_date">Nacimiento *</label>
                        </div>
                    </div>

                    <!-- Fecha fallecimiento -->
                    <div class="col-md-2">
                        <div class="form-floating">
                            <input type="date" name="death_date" id="death_date" class="form-control" required>
                            <label for="death_date">Fallecimiento *</label>
                        </div>
                    </div>

                    <!-- País -->
                    <div class="col-md-2">
                        <div class="form-floating">
                            <select name="country" id="country" class="form-select">
                                <option disabled selected>Selecciona país</option>
                            </select>
                            <label for="country">País</label>
                        </div>
                    </div>

                    <!-- Ciudad -->
                    <div class="col-md-3">
                        <div class="form-floating">
                            <select name="city" id="city" class="form-select">
                                <option disabled selected>Selecciona ciudad</option>
                            </select>
                            <label for="city">Ciudad </label>
                        </div>
                    </div>

                    <!-- Biografía -->
                    <div class="col-12">
                        <div class="form-floating">
                            <textarea name="biography" id="biography" class="form-control" style="height: 100px"></textarea>
                            <label for="biography">Biografía</label>
                        </div>
                    </div>

                    <!-- Despedida -->
                    <div class="col-12">
                        <div class="form-floating">
                            <textarea name="farewell" id="farewell" class="form-control" style="height: 100px"></textarea>
                            <label for="farewell">Mensaje de despedida</label>
                        </div>
                    </div>

                    <!-- Foto -->
                    <div class="col-6">
                        <label for="photo" class="form-label">Foto del animal</label>
                        <input type="file" name="photo" id="photo" class="form-control" accept="image/jpeg,image/png,image/webp">
                        <small class="text-muted">Formatos permitidos: JPG, PNG, WEBP. Solo imágenes del animal, contenido inapropiado será eliminado.</small>
                    </div>

                    <!-- Botón -->
                    <div class="col-12 mt-3">
                        <button type="submit" class="btn btn-success rounded-pill px-5 py-2">Guardar obituario</button>
                    </div>

                </div>
            </form>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ parent() }}
    <script>
        document.getElementById('toggle-form-btn').addEventListener('click', function () {
            const formContainer = document.getElementById('mascota-form-container');
            formContainer.classList.toggle('d-none');
        });

        document.getElementById('photo').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('Solo se permiten imágenes JPG, PNG o WEBP.');
                event.target.value = '';
            }

            if (file.size > 5 * 1024 * 1024) {
                alert('La imagen no debe superar los 5MB.');
                event.target.value = '';
            }
        });
    </script>
    <script src="/js/obituary-data.js"></script>
{% endblock %}
